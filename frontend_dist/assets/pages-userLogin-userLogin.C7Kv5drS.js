import{r as e,c as s,o as a,g as l,s as o,a as t,b as n,w as c,n as u,i as r,d as i,e as d,f,h as p,t as g,j as _,k as v,I as m,l as y}from"./index-2gCYdGq0.js";import{u as h}from"./userAuth.Bhpsn2CI.js";import{_ as C}from"./_plugin-vue_export-helper.BGUu7VIo.js";const w=C({__name:"userLogin",setup(C){const{login:w,checkLoginStatus:b,currentUser:k}=h(),P=e(""),j=e(!1),x=s((()=>{const e=l("serverConfig");return(null==e?void 0:e.serverHost)||"未配置"})),I=async()=>{if(P.value.trim()){j.value=!0;try{const e=await w(P.value);e.success?(_({title:"登录成功",icon:"success"}),t({url:"/pages/musicPlayer/musicPlayer",success:()=>{console.log("跳转成功")},fail:e=>{console.error("跳转失败:",e),_({title:"页面跳转失败",icon:"none"})}})):_({title:e.message||"登录失败",icon:"none"})}catch(e){console.error("登录失败:",e),_({title:"登录失败，请检查网络连接",icon:"none"})}finally{j.value=!1}}else _({title:"请输入密码",icon:"none"})},L=()=>{u({url:"/pages/serverConfig/serverConfig"})};return a((async()=>{const e=l("serverConfig");if(!e||!e.url)return void o({title:"需要配置服务器",content:"请先配置服务器地址才能使用",showCancel:!1,success:()=>{L()}});(await b()).isLoggedIn&&(console.log("检测到有效登录状态，准备跳转"),t({url:"/pages/musicPlayer/musicPlayer",success:()=>{console.log("自动登录跳转成功")},fail:e=>{console.error("自动登录跳转失败:",e)}}))})),(e,s)=>{const a=v,l=r,o=m,t=y;return i(),n(l,{class:"login-page"},{default:c((()=>[d(l,{class:"login-card"},{default:c((()=>[d(l,{class:"card-header"},{default:c((()=>[d(a,{class:"app-icon"},{default:c((()=>[f("🎵")])),_:1}),d(a,{class:"app-title"},{default:c((()=>[f("音乐一起听")])),_:1}),d(a,{class:"app-subtitle"},{default:c((()=>[f("请输入密码登录")])),_:1}),d(a,{class:"app-author"},{default:c((()=>[f("作者：QuietPeng")])),_:1})])),_:1}),d(l,{class:"login-form"},{default:c((()=>[d(l,{class:"form-group"},{default:c((()=>[d(l,{class:"input-wrapper"},{default:c((()=>[d(a,{class:"input-icon"},{default:c((()=>[f("🔒")])),_:1}),d(o,{class:"password-input",modelValue:P.value,"onUpdate:modelValue":s[0]||(s[0]=e=>P.value=e),type:"password",placeholder:"请输入密码",onConfirm:I},null,8,["modelValue"])])),_:1})])),_:1}),d(t,{class:p(["login-btn",{loading:j.value}]),onClick:I,disabled:!P.value||j.value},{default:c((()=>[j.value?(i(),n(a,{key:0},{default:c((()=>[f("登录中...")])),_:1})):(i(),n(a,{key:1},{default:c((()=>[f("登录")])),_:1}))])),_:1},8,["disabled","class"])])),_:1}),d(l,{class:"login-info"},{default:c((()=>[d(a,{class:"info-text"},{default:c((()=>[f("登录有效期：30天")])),_:1}),d(l,{class:"server-config-entry"},{default:c((()=>[d(t,{class:"config-btn",onClick:L},{default:c((()=>[d(a,{class:"config-icon"},{default:c((()=>[f("⚙️")])),_:1}),d(a,null,{default:c((()=>[f("服务器配置")])),_:1})])),_:1}),d(a,{class:"server-hint"},{default:c((()=>[f("当前服务器: "+g(x.value),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-71ec35f0"]]);export{w as default};
