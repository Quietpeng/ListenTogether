import{r as e,c as a,o as l,g as s,b as t,w as u,i as c,d as o,e as n,f as r,t as v,m as d,p as i,q as f,F as _,h as p,j as m,s as h,u as g,v as b,k,l as x,I as y,x as w}from"./index-2gCYdGq0.js";import{_ as C,u as H}from"./_plugin-vue_export-helper.BGUu7VIo.js";const I=C({__name:"serverConfig",setup(C){const{testConnection:I,saveServerConfig:P,connectionState:z}=H(),$=e(""),A=e(""),T=e(!0),V=e(!1),Z=e(!1),j=e(!1),S=e(""),U=e(null),q=e([{label:"localhost",host:"localhost"},{label:"本地IP",host:"192.168.1.100"},{label:"内网穿透示例",host:"xxxx.gcsyweb.cn"}]),B=a((()=>$.value&&!S.value)),D=a((()=>{if(!$.value)return"";const e=T.value?"https":"http",a=A.value?`:${A.value}`:"";return`${e}://${$.value}${a}`}));l((()=>{E()}));const E=()=>{try{const e=s("serverConfig");e?($.value=e.serverHost||"",A.value=e.serverPort||"",T.value=void 0===e.useHttps||e.useHttps):($.value="",A.value="",T.value=!0)}catch(e){console.error("加载配置失败:",e)}},F=e=>{$.value=e.detail.value.trim(),S.value="",U.value=null},Q=e=>{A.value=e.detail.value},G=e=>{T.value=e.detail.value},J=()=>{if(!$.value)return S.value="请输入服务器地址",!1;return/^[a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?(\.[a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?)*$/.test($.value)||/^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test($.value)?(S.value="",!0):(S.value="请输入有效的域名或IP地址",!1)},K=()=>{V.value=!V.value},L=async()=>{if(J()){Z.value=!0,U.value=null;try{const e={url:D.value,serverHost:$.value,serverPort:A.value,useHttps:T.value},a=await I(e);a.success?(U.value={success:!0,title:"连接成功",message:a.message||"服务器响应正常"},m({title:"连接成功",icon:"success"})):U.value={success:!1,title:"连接失败",message:a.message||"无法连接到服务器"}}catch(e){U.value={success:!1,title:"连接失败",message:e.message||"连接出现异常"},console.error("测试连接失败:",e)}finally{Z.value=!1}}},M=async()=>{if(J()){j.value=!0;try{const e={serverHost:$.value,serverPort:A.value,useHttps:T.value,url:D.value,savedTime:Date.now()},a=await P(e);if(!a.success)throw new Error(a.message||"保存失败");m({title:a.message||"配置已保存",icon:"success"}),setTimeout((()=>{O()}),1500)}catch(e){console.error("保存配置失败:",e),m({title:e.message||"保存失败",icon:"none"})}finally{j.value=!1}}},N=()=>{h({title:"确认清除",content:"确定要清除所有服务器配置吗？",success:e=>{e.confirm&&(g("serverConfig"),g("userInfo"),g("token"),$.value="",A.value="",T.value=!0,U.value=null,m({title:"配置已清除",icon:"success"}))}})},O=()=>{b()};return(e,a)=>{const l=k,s=x,h=c,g=y,b=w;return o(),t(h,{class:"server-config-page"},{default:u((()=>[n(h,{class:"nav-bar"},{default:u((()=>[n(s,{class:"btn-back",onClick:O,size:"mini"},{default:u((()=>[n(l,{class:"back-icon"},{default:u((()=>[r("←")])),_:1}),n(l,null,{default:u((()=>[r("返回")])),_:1})])),_:1})])),_:1}),n(h,{class:"config-card"},{default:u((()=>[n(h,{class:"app-header"},{default:u((()=>[n(l,{class:"app-icon"},{default:u((()=>[r("🎵")])),_:1}),n(l,{class:"app-title"},{default:u((()=>[r("音乐一起听")])),_:1}),n(l,{class:"app-author"},{default:u((()=>[r("作者：QuietPeng")])),_:1})])),_:1}),n(h,{class:"config-form"},{default:u((()=>[n(l,{class:"form-title"},{default:u((()=>[r("服务器配置")])),_:1}),n(l,{class:"form-description"},{default:u((()=>[r("请输入您的服务器地址以开始使用")])),_:1}),n(h,{class:"form-group"},{default:u((()=>[n(l,{class:"form-label"},{default:u((()=>[r("服务器地址")])),_:1}),n(h,{class:"input-group"},{default:u((()=>[n(l,{class:"input-prefix"},{default:u((()=>[r("https://")])),_:1}),n(g,{class:"server-input",modelValue:$.value,"onUpdate:modelValue":a[0]||(a[0]=e=>$.value=e),placeholder:"www.example.com",onInput:F,onBlur:J},null,8,["modelValue"])])),_:1}),n(h,{class:"input-hint"},{default:u((()=>[n(l,{class:"hint-icon"},{default:u((()=>[r("ℹ️")])),_:1}),n(l,{class:"hint-text"},{default:u((()=>[r("请输入服务器的域名或IP地址")])),_:1})])),_:1}),S.value?(o(),t(l,{key:0,class:"error-text"},{default:u((()=>[r(v(S.value),1)])),_:1})):d("",!0)])),_:1}),n(h,{class:"examples-section"},{default:u((()=>[n(l,{class:"examples-title"},{default:u((()=>[r("常用示例：")])),_:1}),n(h,{class:"example-chips"},{default:u((()=>[(o(!0),i(_,null,f(q.value,(e=>(o(),t(s,{class:"example-chip",key:e.host,onClick:a=>{return l=e.host,$.value=l,S.value="",U.value=null,void m({title:`已选择: ${l}`,icon:"none"});var l}},{default:u((()=>[r(v(e.label),1)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1}),n(h,{class:"advanced-section"},{default:u((()=>[n(h,{class:"advanced-header",onClick:K},{default:u((()=>[n(l,{class:"advanced-title"},{default:u((()=>[r("高级选项")])),_:1}),n(l,{class:p(["advanced-arrow",{expanded:V.value}])},{default:u((()=>[r("▼")])),_:1},8,["class"])])),_:1}),V.value?(o(),t(h,{key:0,class:"advanced-content"},{default:u((()=>[n(h,{class:"form-group"},{default:u((()=>[n(l,{class:"form-label"},{default:u((()=>[r("端口号")])),_:1}),n(g,{class:"port-input",modelValue:A.value,"onUpdate:modelValue":a[1]||(a[1]=e=>A.value=e),type:"number",placeholder:"8080",onInput:Q},null,8,["modelValue"])])),_:1}),n(h,{class:"form-group"},{default:u((()=>[n(h,{class:"switch-row"},{default:u((()=>[n(l,{class:"switch-label"},{default:u((()=>[r("使用 HTTPS")])),_:1}),n(b,{checked:T.value,onChange:G,color:"#667eea"},null,8,["checked"])])),_:1})])),_:1})])),_:1})):d("",!0)])),_:1}),$.value?(o(),t(h,{key:0,class:"connection-test"},{default:u((()=>[n(s,{class:p(["test-btn",{testing:Z.value}]),onClick:L,disabled:Z.value},{default:u((()=>[n(l,{class:"test-icon"},{default:u((()=>[r("🔍")])),_:1}),n(l,null,{default:u((()=>[r(v(Z.value?"测试连接中...":"测试连接"),1)])),_:1})])),_:1},8,["class","disabled"]),U.value?(o(),t(h,{key:0,class:"test-result"},{default:u((()=>[n(h,{class:p(["result-alert",{success:U.value.success,error:!U.value.success}])},{default:u((()=>[n(l,{class:"result-icon"},{default:u((()=>[r(v(U.value.success?"✅":"❌"),1)])),_:1}),n(h,{class:"result-content"},{default:u((()=>[n(l,{class:"result-title"},{default:u((()=>[r(v(U.value.title),1)])),_:1}),n(l,{class:"result-message"},{default:u((()=>[r(v(U.value.message),1)])),_:1}),U.value.responseTime?(o(),t(l,{key:0,class:"result-time"},{default:u((()=>[r(" 响应时间: "+v(U.value.responseTime)+"ms ",1)])),_:1})):d("",!0)])),_:1})])),_:1},8,["class"])])),_:1})):d("",!0)])),_:1})):d("",!0),n(h,{class:"form-actions"},{default:u((()=>[n(s,{class:"clear-btn",onClick:N},{default:u((()=>[r(" 🗑️ 清除配置 ")])),_:1}),n(s,{class:p(["save-btn",{saving:j.value}]),onClick:M,disabled:!B.value||j.value},{default:u((()=>[j.value?(o(),t(l,{key:0},{default:u((()=>[r("保存中...")])),_:1})):(o(),t(l,{key:1},{default:u((()=>[r("💾 保存配置")])),_:1}))])),_:1},8,["disabled","class"])])),_:1})])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-a32a0b9e"]]);export{I as default};
